{% extends 'generic/object.html' %}
{% load static %}
{% load helpers %}
{% load plugins %}
{% load render_table from django_tables2 %}
{% load i18n %}

{% block title %}{{ object }} - Diff{% endblock %}

{% block content %}
  <div class="card">
    <table class="table object-list">
      <thead>
        <tr>
          <th>{% trans "Object" %}</th>
          <th>{% trans "Action" %}</th>
          <th>{% trans "Original" %}</th>
          <th>{% trans "Current" %}</th>
          <th>{% trans "Changed" %}</th>
        </tr>
      </thead>
      <tbody>
        {% for change in diffs %}
          <tr{% if change.conflicts %} class="table-danger"{% endif %}>
            <td>
              {% if change.object %}
                {{ change.object|linkify }}
              {% else %}
                {{ change.object_repr }}
              {% endif %}
            </td>
            <td>
              {# TODO: Clean this up #}
              {% if change.action == 'create' %}
                <span class="badge bg-green text-green-fg">Created</span>
              {% elif change.action == 'update' %}
                <span class="badge bg-blue text-blue-fg">Updated</span>
              {% elif change.action == 'delete' %}
                <span class="badge bg-red text-red-fg">Deleted</span>
              {% endif %}
            </td>
            <td>
              {% for k, v in change.original.items %}
                <div class="font-monospace">
                  {{ k }}: {{ v|placeholder }}
                </div>
              {% empty %}
                {{ ''|placeholder }}
              {% endfor %}
            </td>
            <td>
              {% for k, v in change.current.items %}
                <div class="font-monospace">
                  {{ k }}: {% if k in change.conflicts %}<span class="bg-red text-red-fg">{{ v|placeholder }}</span>{% else %}{{ v|placeholder }}{% endif %}
                </div>
              {% empty %}
                {{ ''|placeholder }}
              {% endfor %}
            </td>
            <td>
              {% for k, v in change.modified.items %}
                <div class="font-monospace">
                  {{ k }}: {% if k in change.conflicts %}<span class="bg-red text-red-fg">{{ v|placeholder }}</span>{% else %}{{ v|placeholder }}{% endif %}
                </div>
              {% empty %}
                <span class="text-muted">Deleted</span>
              {% endfor %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock content %}
